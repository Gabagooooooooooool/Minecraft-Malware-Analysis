# Skidfuscator Extraction 101
## How to extract URLs of malware servers from SkidFuscator protected jars.

## Requirements
- Java Knowledge
- Brain
- RAT File (We will be using https://github.com/skyblockgens/SimpleForaging as an example)
- A copy of Proycon and CFR.

## How i preformed extraction?

First i put the malware trought the RatRater (https://ktibow.github.io/RatRater/) IMEI tool. This allowed me to see what class contained the payload.

![a](https://user-images.githubusercontent.com/116589326/224560897-abef27a3-0b4b-46e0-b1e8-61b347c0c995.png)

After this - lets begin!

First we need to focus on the main SkidFuscator obfuscation driver. 

![a](https://user-images.githubusercontent.com/116589326/224560913-fb420e7d-1e63-48c0-8caf-128b981571c8.png)

Lets simplify and analyze the "flow" of the code. I covered all the private classes, removed "scaring" annotations and highlighted what is returned

![a](https://user-images.githubusercontent.com/116589326/224560979-aa96de23-a086-437f-bc93-5d8565eefddf.png)

The paramter is ignored. This main obfuscation driver can be written as 

```java
public class Driver
{
    public static int get(final String ignored) {
        return 419957961;
    }
}
```

We will need this class later.

Now let's focus on payload method.

![a ](https://user-images.githubusercontent.com/116589326/224561023-7902622b-c123-4dd7-b0f9-3ef40748342d.png)

When we scroll we can find the ssid getter. But we can find something also intresing 

![a](https://user-images.githubusercontent.com/116589326/224561034-ad08faf7-f572-4476-9cb6-307e266d178e.png)

Gotcha! It's the URL. Lets analyze it:

![a](https://user-images.githubusercontent.com/116589326/224561042-2e84a8b3-ae6d-4a1c-8c94-f02b0c53ba0b.png)

Now we take a deeper look at the mysterious var256. It's not defined elsewhere in the code. Decompiler was wrong, but it got an idea - var256 is local int that is used as an encryption key.
The Rm2B7W5ebn is a diffrent thing. We can find the initalization in two places - Beginning of the class and static field. As static fields are initalized after, lets look at it:

![a](https://user-images.githubusercontent.com/116589326/224561066-b5c8e700-b515-4c0d-8289-2dacc336976a.png)

Bingo! It's using the Driver class. We can simplify this code as:

```java
Rm2B7W5ebn = (0xEBE75CA5 ^ (0x5E0D61D3 ^ (0x199D5759 ^ 419957961)) ^ new Random(6744416443638849925L).nextInt());
```

Take a look at hcozxtqkdupeevy. It's a simple ByteArray! Save it for later.

![a](https://user-images.githubusercontent.com/116589326/224561084-317813c8-71cf-435a-9657-dbf652f1eb6a.png)

Encryption method is very simple and can be simply copy-pasted.

![a](https://user-images.githubusercontent.com/116589326/224561125-57b852c5-bf5f-4659-889a-6e5e764b83e4.png)

Now lets put the code together!

We should end up with something like this:

```java
public class Main {

    static int Rm2B7W5ebn = (0xEBE75CA5 ^ (0x5E0D61D3 ^ (0x199D5759 ^ 419957961)) ^ new Random(6744416443638849925L).nextInt());
    private static byte[] hcozxtqkdupeevy() {
        return new byte[] { -109, -103, 3, 101, 94, 7, 44, 44, 28, 24, 117, 18, 80, 112, 83, 4, 106, 68, 3, 104, 89, 24, 46, 54, 30, 12, 114, 25, 80, 53, 84, 77, 104, 21, 1, 102, 94, 2, 46, 40, 25, 6, 112, 19, 82, 106, 83, 64, 104, 8, 6, 127, 92, 18, 44, 48, 30, 27, 112, 11, 85, 58, 81, 85, 106, 70, 1, 99, 92, 25, 43, 56, 28, 76 };
    }

    private static String thisIsAInsaneEncryptionMethod(final byte[] array, final int n) {
        final byte[] bytes = Integer.toString(n).getBytes();
        final byte[] array2 = { 92, 95, 55, 52, 104, 68, 26, 108, 40, 90, 68, 88, 100, 115, 101, 28 };
        for (int i = 0; i < array.length; ++i) {
            array[i] ^= bytes[i % bytes.length];
            array[i] ^= array2[i % array2.length];
        }
        return new String(array, StandardCharsets.UTF_16);
    }


    public static void main(String[] args){
        int var256 = 1937940518 ^ (1810357161 ^ Rm2B7W5ebn);
        var256 = 1855148573 ^ var256;
        String var1_2 = thisIsAInsaneEncryptionMethod(hcozxtqkdupeevy(), var256);
    }
}
```

From this code we can add a simple System.out.println() and get the server url. 

Here is the censored output:

```
https://necauth******.hero*****.com/

Process finished with exit code 0
```
